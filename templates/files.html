{% extends "base.html" %}
{% block title %}File Manager — FlaskVault{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
        <div>
            <h1 class="fw-bold mb-1">
                <i class="bi bi-folder2-open me-2 text-accent"></i>File Manager
            </h1>
            <p class="text-secondary mb-0">Upload, download, and manage your documents.</p>
        </div>
        <button class="btn btn-accent rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <i class="bi bi-cloud-arrow-up me-1"></i>Upload File
        </button>
    </div>

    <!-- File table -->
    <div class="card glass-card p-0 overflow-hidden">
        {% if files | length > 0 %}
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0">
                <thead>
                    <tr class="text-secondary small text-uppercase">
                        <th class="ps-4">File</th>
                        <th>Uploaded</th>
                        <th class="text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for f in files %}
                    <tr>
                        <td class="ps-4">
                            <i class="bi bi-file-earmark me-2 text-accent"></i>{{ f.original_filename }}
                        </td>
                        <td class="text-secondary small">
                            {{ f.upload_date.strftime('%b %d, %Y %H:%M') }}
                        </td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('files.download', file_id=f.id) }}"
                                class="btn btn-sm btn-outline-light rounded-pill me-1" title="Download">
                                <i class="bi bi-download"></i>
                            </a>
                            <form method="POST" action="{{ url_for('files.delete', file_id=f.id) }}" class="d-inline"
                                onsubmit="return confirm('Delete this file?')">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                <button type="submit" class="btn btn-sm btn-outline-danger rounded-pill" title="Delete">
                                    <i class="bi bi-trash3"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox fs-1 text-secondary mb-3 d-block"></i>
            <p class="text-secondary">No files yet. Click <strong>Upload File</strong> to get started!</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- ─── Upload Modal ────────────────────────────────────────────────── -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-semibold">
                    <i class="bi bi-cloud-arrow-up me-2 text-accent"></i>Upload a file
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('files.upload') }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <div class="modal-body">
                    <p class="text-secondary small mb-3">
                        Allowed: <code>pdf, png, jpg, jpeg, gif, txt, csv, docx, xlsx, zip</code>&nbsp;&middot;&nbsp;Max
                        16 MB
                    </p>
                    <input type="file" class="form-control" name="file" required />
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary rounded-pill px-3"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-accent rounded-pill px-4">
                        <i class="bi bi-upload me-1"></i>Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}